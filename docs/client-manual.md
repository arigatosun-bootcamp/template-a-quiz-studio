# JapanMaster ～日本制覇への道～ クライアント説明マニュアル

---

## 1. アプリ概要

### 一言で言うと

**AIが日本に関するクイズを自動で作ってくれるWebアプリ**です。
ユーザーはクイズに答えながら、47都道府県の知識を深めていきます。

### 3つの特徴

| 特徴 | 説明 |
|------|------|
| **AIが問題を自動生成** | Google Gemini AIが毎回新しいクイズを作るので、問題がなくなりません |
| **47都道府県を制覇** | 正解すると日本地図に色がつき、全国制覇を目指すゲーム性があります |
| **スマホでもPCでも** | レスポンシブ対応で、どのデバイスからでも利用できます |

### 技術構成

| 項目 | 使用技術 | 役割 |
|------|---------|------|
| フロントエンド + API | Next.js（TypeScript） | 画面表示とサーバー処理 |
| データベース・認証 | Supabase（PostgreSQL） | ユーザー情報・クイズデータの保存 |
| クイズ生成AI | Gemini API | 問題文・選択肢・解説の自動生成 |
| デプロイ先 | Vercel | Webサーバーのホスティング |
| テスト | Vitest | 自動テスト |

---

## 2. ユーザーの利用フロー（全体像）

```
新規登録 → メール確認 → ログイン → ジャンル選択 → 難易度選択
  → クイズ5問に回答 → 結果確認 → 日本地図で進捗確認
```

この繰り返しで47都道府県 × 3難易度 = 141パターンの制覇を目指します。

---

## 3. 画面一覧と説明

### 認証画面（ログイン前）

| 画面 | URL | 説明 |
|------|-----|------|
| ログイン | `/login` | メールアドレスとパスワードでログイン |
| 新規登録 | `/register` | メールアドレスとパスワードでアカウント作成 |
| パスワードリセット | `/reset-password` | パスワードを忘れた場合にリセットメールを送信 |

### メイン画面（ログイン後）

| 画面 | URL | 説明 |
|------|-----|------|
| トップ | `/` | 日本地図の表示、ジャンル・難易度を選んでクイズ開始 |
| クイズ | `/quiz` | 5問のクイズに回答する画面。1問ずつ正誤と解説が表示される |
| 結果 | `/result` | 正解数・全問の振り返り・解説を確認できる画面 |
| 回答履歴 | `/history` | 過去のクイズセッション一覧。展開して詳細も確認可能 |
| 達成状況 | `/achievement` | 都道府県の制覇率、難易度別進捗、正答率の統計 |
| 設定 | `/settings` | パスワード変更・アカウント削除 |

### エラー画面

| 画面 | 説明 |
|------|------|
| 404ページ | 存在しないURLにアクセスした場合。「トップに戻る」ボタンで復帰 |
| エラーページ | サーバーエラーが発生した場合。「再試行」ボタンで復帰 |

---

## 4. 各画面の詳しい説明

### 4.1 新規登録からログインまで

1. アプリにアクセスすると、未ログインの場合はログイン画面にリダイレクトされます
2. 「新規登録はこちら」をクリックして登録画面へ
3. 以下を入力して「新規登録」ボタンを押します
   - メールアドレス
   - パスワード（8文字以上）
   - パスワード確認（同じものを再入力）
   - 利用規約・プライバシーポリシーへの同意チェック
4. 確認メールが届くので、メール内のリンクをクリック
5. ログイン画面に戻るので、メールとパスワードでログイン

### 4.2 トップ画面

ログイン後に最初に表示される画面です。

**表示される内容:**
- **日本地図** — 自分の進捗が色で分かる（タップで達成状況画面へ）
- **ステップ1: ジャンル選択** — 「地理」「観光名所」「ご当地グルメ」から1つ選択
- **ステップ2: 難易度選択** — 「初級」「中級」「上級」から1つ選択
- **ステップ3: ゲームスタート！** — クイズ開始ボタン

### 4.3 クイズ画面

5問のクイズに答える画面です。

**1問ごとの流れ:**
1. 進捗表示（「問題 1 / 5」）と問題文が表示される
2. 3つの選択肢から1つをタップして選ぶ
3. 「回答する」ボタンを押す
4. 正解/不正解が即座に表示される
   - **正解の場合**: 緑色で「正解！」と表示 + 解説
   - **不正解の場合**: 赤色で「不正解」と表示 + 正解の選択肢を緑で表示 + 解説
5. 「次の問題へ」で次に進む（5問目は「結果を見る」）

**制限時間はありません。** じっくり考えて回答できます。

### 4.4 結果画面

5問すべて回答後に表示されます。

**表示される内容:**
- **正解数**: 「5問中 ○問正解！」
- **メッセージ**:
  - 5問正解 →「パーフェクト！日本マスターへの道を順調に進んでいます！」
  - 3〜4問正解 →「いい調子です！もう少しで全問正解！」
  - 1〜2問正解 →「次はもっと上を目指しましょう！」
  - 0問正解 →「ドンマイ！挑戦することが大事です！」
- **全問の振り返り**: 問題文・自分の回答・正解・解説が一覧で確認可能
- **ボタン**:
  - 「同じ条件でもう一度」— 同じジャンル・難易度で再挑戦
  - 「トップに戻る」— トップ画面へ戻る

### 4.5 回答履歴画面

過去のクイズセッションを新しい順に一覧表示します。

- 1ページ10件のページネーション付き
- 各セッションには「日付・ジャンル・難易度・スコア」が表示
- タップで展開すると、全5問の問題・回答・解説を確認可能
- データがない場合は「まだ回答履歴がありません」と表示

### 4.6 達成状況画面

47都道府県の制覇状況と統計データを表示します。

- **制覇率**: 「47都道府県中 ○個クリア」+ 進捗バー
- **難易度別の制覇数**:
  - 初級: ○/47
  - 中級: ○/47
  - 上級: ○/47
- **全体の統計**: 総回答数、全体正答率
- **ジャンル別の正答率**: 地理 ○%、観光名所 ○%、グルメ ○%
- **日本地図**: 色分けで進捗を視覚的に確認

### 4.7 設定画面

- **パスワード変更**: 現在のパスワード → 新しいパスワード → 確認入力
- **アカウント削除**: 確認ダイアログの後、アカウントと全データを完全削除

---

## 5. クイズの仕組み

### ジャンル（3種類）

| ジャンル | 出題される内容の例 |
|----------|-------------------|
| 地理 | 都道府県の位置・県庁所在地・地形・面積 |
| 観光名所 | 名所・世界遺産・名勝・お祭り |
| ご当地グルメ | 郷土料理・名産品・B級グルメ |

### 難易度（3段階）

| 難易度 | 基準 |
|--------|------|
| 初級 | 誰でも知っている基本知識。選択肢を見ればわかるレベル |
| 中級 | 旅行好きなら知っている知識。少し考える必要があるレベル |
| 上級 | 現地の人や詳しい人向け。マニアックな知識が必要なレベル |

### 出題ロジック

- 1回5問、すべて**異なる都道府県**から出題
- まだ正解していない都道府県が**優先的に出題**される
- 全県正解済みの場合は全47県からランダム
- AIが毎回新しい問題を生成するため、同じ問題は基本的に出ない

### 都道府県の制覇ルール

- ある県の問題に正解すると、その県はその難易度で「クリア」
- より高い難易度でクリアすると、記録が更新される（初級→中級→上級）
- 低い難易度で再クリアしても記録は下がらない

---

## 6. 日本地図の色分け

| 色 | 意味 |
|----|------|
| グレー | まだクリアしていない |
| 薄い緑（若草色） | 初級でクリア済み |
| 緑（抹茶色） | 中級でクリア済み |
| 深い緑 | 上級でクリア済み |

---

## 7. 制限事項・ルール

| 項目 | 内容 |
|------|------|
| 1日の利用上限 | 20回（毎日0:00にリセット） |
| 1回の問題数 | 5問固定 |
| 回答形式 | 3択（選択式） |
| 制限時間 | なし |
| パスワード要件 | 8文字以上 |
| ログイン失敗上限 | 5回失敗で30分ロック |
| セッション有効期間 | 7日間（期限切れで再ログインが必要） |

---

## 8. ナビゲーション

### PC版（768px以上）

ヘッダーにメニューが横並びで表示されます。

```
[JapanMaster ロゴ]   [回答履歴]  [達成状況]  [設定]  [ログアウト]
```

### スマホ版（768px未満）

右上のハンバーガーメニュー（≡）をタップすると、メニューがスライド表示されます。

```
[JapanMaster]                              [≡]
```

**ログアウト時:** 確認ダイアログが表示され、「はい」でログイン画面に戻ります。

---

## 9. エラーが起きた場合

| 状況 | ユーザーに表示されるメッセージ | 対処法 |
|------|-------------------------------|--------|
| クイズ生成に失敗 | 「問題の生成に失敗しました。もう一度お試しください」 | 「再試行」ボタンを押す |
| ネットワーク切断 | 「通信に失敗しました」 | ページを再読み込み |
| 存在しないページ | 「ページが見つかりません」 | 「トップに戻る」ボタンを押す |
| サーバーエラー | 「サーバーでエラーが発生しました」 | 時間をおいて再度アクセス |
| 利用上限到達 | 「本日の利用上限に達しました。明日またお楽しみください」 | 翌日0:00以降に再利用 |

※クイズ生成は内部で最大3回自動リトライします。3回すべて失敗した場合のみエラーが表示されます。

---

## 10. データの管理

### 保存されるデータ

| データ | 保存期間 |
|--------|---------|
| アカウント情報（メールアドレス） | アカウント削除まで |
| クイズのセッション記録 | アカウント削除まで |
| 各問題への回答結果 | アカウント削除まで |
| 都道府県ごとの制覇状況 | アカウント削除まで |

### セキュリティ

- **RLS（Row Level Security）**: ユーザーは自分のデータのみアクセス可能
- **CASCADE削除**: アカウント削除時に関連する全データが自動削除
- **認証必須**: ログインしないとアプリのどの機能も使えない

### アカウント削除

設定画面からアカウントを削除できます。削除すると以下がすべて消えます:
- アカウント情報
- 全クイズ履歴
- 全回答データ
- 都道府県の制覇記録

**この操作は取り消せません。**

---

## 11. API利用コスト

### クイズ生成にかかる費用

本アプリはGoogle Gemini API（Gemini 2.5 Flash モデル）を使ってクイズを自動生成しています。
1ゲーム（5問）あたりのAPI費用は以下の通りです。

| 項目 | 内容 |
|------|------|
| 使用モデル | Gemini 2.5 Flash |
| 1ゲームあたりのAPIコール | 1回（5問をまとめて生成） |
| 入力トークン数（プロンプト） | 約400トークン |
| 出力トークン数（5問のJSON） | 約1,000トークン |

### 料金の目安

Gemini 2.5 Flash の料金（2026年2月時点）:
- 入力: $0.10 / 100万トークン
- 出力: $0.40 / 100万トークン

| 利用規模 | 費用（日本円換算・1ドル=150円） |
|---------|-------------------------------|
| **1ゲーム（5問）** | **約0.07円** |
| 1日の上限（20ゲーム） | 約1.4円 |
| 100ゲーム | 約7円 |
| 1,000ゲーム | 約66円 |

**非常に低コスト** で運用できます。仮に100人のユーザーが毎日上限まで遊んでも、1日あたり約140円程度です。

### リトライについて

クイズ生成に失敗した場合、内部で最大3回まで自動リトライします。
最悪のケース（3回リトライ）でも、1ゲームあたり約0.2円程度です。

---

## 12. 今後の拡張予定（フェーズ2以降）

現在のフェーズ1には含まれていない機能です。

- Googleアカウントでのログイン（Google OAuth連携）
- 英語対応（多言語化）
- ランキング・リーダーボード
- SNSシェア機能
- お気に入り問題のブックマーク
- タイムアタックモード
- ダークモード
- オフライン対応
- 広告配信（現在はスペースのみ確保）

---

## 13. よくある質問（FAQ）

**Q: 同じ問題が出ることはありますか？**
A: AIが毎回新しく生成するため、基本的に同じ問題は出ません。

**Q: クイズの途中でアプリを閉じたらどうなりますか？**
A: 途中のデータは保存されません。次回は最初からやり直しになります。

**Q: 1日に何回遊べますか？**
A: 20回まで（5問 × 20回 = 合計100問/日）。毎日0:00にリセットされます。

**Q: パスワードを忘れました。**
A: ログイン画面の「パスワードを忘れた方はこちら」からリセットメールを送信できます。

**Q: アカウントを削除したら復元できますか？**
A: できません。全データが完全に削除されます。

**Q: スマートフォンとPCで同じアカウントを使えますか？**
A: はい。同じメールアドレスでログインすれば、どのデバイスからでも同じデータにアクセスできます。
